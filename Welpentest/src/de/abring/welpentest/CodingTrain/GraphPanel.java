/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package de.abring.welpentest.CodingTrain;

import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Point;
import java.awt.Stroke;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;
import javax.swing.JPanel;

/**
 *
 * @author Karima
 */
public class GraphPanel extends JPanel{
    
    public static final int DIRECT_GRAPH    = 0;
    public static final int SQUARE_GRAPH    = 1;
    public static final int BAR_GRAPH       = 2;
    
    private int maxX = 0;
    private int maxY = 0;
    
    private int graphType = GraphPanel.DIRECT_GRAPH;
    
    private Stroke stroke = new BasicStroke(2);
    
    private Color backGroundColor = Color.WHITE;
    private Color color = Color.RED;
    
    private final List<Point> ticks = new ArrayList<>();
    
    public GraphPanel() {
        this.setSize(100, 200);
        this.setPreferredSize(new Dimension(100, 120));
        this.setMinimumSize(new Dimension(50, 50));
        this.setMaximumSize(new Dimension(4000, 2000));
        this.setBorder(javax.swing.BorderFactory.createLineBorder(Color.BLACK));
    }
    
    /**
     *
     * @param p
     */
    public void addPoint(Point p) {
        if (p == null || p.x < 0 || p.y < 0) 
            return;
        
        maxX = Math.max(maxX, p.x);
        maxY = Math.max(maxY, p.y);
        ticks.add(p);
        
        Collections.sort(ticks, (Point lhs, Point rhs) -> lhs.x < rhs.x ? -1 : (lhs.x > rhs.x) ? 1 : 0);
        this.updateUI();
    }
    
    public int getDataMaxValue() {
        int i = 0;
        for (Point p : ticks) {
            i = Math.max(i, p.y);
        }
        return i;
    }
    
    public float getDataAVG() {
        float i = 0.0f;
        for (Point p : ticks) {
            i += p.y;
        }
        return i / ticks.size();
    }
    
    public void clear() {
        maxX = 0;
        maxY = 0;
        ticks.clear();
    }
    
    /**
     *
     * @param g
     */
    @Override
    public void paintComponent(Graphics g) {
        super.paintComponent(g);
        Graphics2D g2 = (Graphics2D) g;
	if (stroke != null)
            g2.setStroke(stroke);
        g2.setBackground(backGroundColor);
        g2.setColor(color);
        g2.clearRect(0, 0, this.getWidth(), this.getHeight());
        if (ticks.isEmpty())
            return;
        Point l = ticks.get(0);
        try {     
            switch(graphType) {
                case GraphPanel.DIRECT_GRAPH:
                    for (Point p : ticks) {
                        g2.drawLine(Math.round(l.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - l.y * this.getHeight() / (float) maxY), Math.round(p.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - p.y * this.getHeight() / (float) maxY));
                        l = p;
                    }
                    break;
                case GraphPanel.SQUARE_GRAPH:
                    for (Point p : ticks) {
                        g2.drawLine(Math.round(l.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - l.y * this.getHeight() / (float) maxY), Math.round(p.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - l.y * this.getHeight() / (float) maxY));
                        g2.drawLine(Math.round(p.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - l.y * this.getHeight() / (float) maxY), Math.round(p.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - p.y * this.getHeight() / (float) maxY));
                        l = p;
                    }
                    break;
                case GraphPanel.BAR_GRAPH:
                    for (Point p : ticks) {
                        g2.drawLine(Math.round(p.x * this.getWidth() / (float) maxX), this.getHeight(), Math.round(p.x * this.getWidth() / (float) maxX), Math.round(this.getHeight() - p.y * this.getHeight() / (float) maxY));
                    }
                    break;
            }
        } catch (java.util.ConcurrentModificationException ex) {
            System.err.println("Graph Paint Error! EGAL!!!");
        }
    }

    /**
     * @return the stroke
     */
    public Stroke getStroke() {
        return stroke;
    }

    /**
     * @param stroke the stroke to set
     */
    public void setStroke(Stroke stroke) {
        this.stroke = stroke;
    }

    /**
     * @return the backGroundColor
     */
    public Color getBackGroundColor() {
        return backGroundColor;
    }

    /**
     * @param backGroundColor the backGroundColor to set
     */
    public void setBackGroundColor(Color backGroundColor) {
        this.backGroundColor = backGroundColor;
    }

    /**
     * @return the color
     */
    public Color getColor() {
        return color;
    }

    /**
     * @param color the color to set
     */
    public void setColor(Color color) {
        this.color = color;
    }

    /**
     * @return the graphType
     */
    public int getGraphType() {
        return graphType;
    }

    /**
     * @param graphType the graphType to set
     */
    public void setGraphType(int graphType) {
        this.graphType = graphType;
    }

    /**
     * @return the maxX
     */
    public int getMaxX() {
        return maxX;
    }

    /**
     * @param maxX the maxX to set
     */
    public void setMaxX(int maxX) {
        this.maxX = maxX;
    }

    /**
     * @return the maxY
     */
    public int getMaxY() {
        return maxY;
    }

    /**
     * @param maxY the maxY to set
     */
    public void setMaxY(int maxY) {
        this.maxY = maxY;
    }
}
